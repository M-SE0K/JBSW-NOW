# Docker setup

### 1. 기존 컨테이너 정리 (삭제)

수정된 코드를 반영하려면 실행 중인 옛날 컨테이너를 먼저 지워야 합니다.

- **실행 중지 및 삭제 (한 번에 하기):**
가장 자주 쓰는 명령어입니다. 실행 중인 컨테이너를 강제로(`f`) 멈추고 삭제합니다.Bash
    
    `docker rm -f <컨테이너_이름_또는_ID>`
    
    *예시: `docker rm -f ollama-api-server`*
    
- **이미지 삭제 (선택 사항):**
빌드할 때 태그(이름)를 똑같이 하면 덮어씌워지므로 필수는 아니지만, 깔끔하게 하고 싶다면 지웁니다.Bash
    
    `docker rmi <이미지_이름>`
    

---

### 2. 이미지 빌드 (Build)

수정한 코드를 바탕으로 새로운 도커 이미지를 만듭니다. **`Dockerfile`이 있는 경로**에서 실행해야 합니다.

- **빌드 명령어:**Bash
    
    `docker build -t <이미지_이름> .`
    
    - `t`: 이미지에 이름을 붙이는 옵션 (Tag)
    - `.`: 현재 디렉토리의 Dockerfile을 사용한다는 의미
    - *예시: `docker build -t my-ollama-server .`*

---

### 3. 배포 및 실행 (Run)

새로 만든 이미지를 기반으로 컨테이너를 실행합니다.

- **실행 명령어:**Bash
    
    `docker run -d -p <호스트포트>:<컨테이너포트> --name <컨테이너_이름> <이미지_이름>`
    
    - `d`: 백그라운드 모드 실행 (Detached)
    - `p`: 포트 연결 (외부접속포트:내부서버포트)
    - `-name`: 관리하기 편하게 컨테이너에 이름 부여
    - *예시 (아까 보여주신 10016 포트 가정):*Bash
        
        `docker run -d -p 10016:3000 --name ollama-api-server my-ollama-server`
        
        *(내부 포트 3000은 프로젝트 설정에 따라 다를 수 있습니다)*
        

---

### 4. 확인 및 로그 보기 (중요!)

배포 후 서버가 제대로 떴는지, 아까 발생한 404 오류가 해결되었는지 로그로 확인합니다.

- **실행 상태 확인:**Bash
    
    `docker ps`
    
- **실시간 로그 확인 (디버깅용):**
서버가 요청을 받을 때 로그가 찍히는지 실시간으로 볼 수 있습니다.Bash
    
    `docker logs -f <컨테이너_이름>`
    
    - 이 상태에서 프론트엔드에서 다시 요청을 보내보면, 로그에 `/api/ollama/chat`으로 정상적으로 들어오는지, 아니면 여전히 중복된 경로가 찍히는지 바로 알 수 있습니다.

---

### 💡 (참고) Docker Compose를 쓴다면?

만약 프로젝트에 `docker-compose.yml` 파일이 있다면 위 과정이 훨씬 간단해집니다.

- **빌드 후 바로 재배포 (이거 하나면 끝):**Bash
    
    `docker-compose up -d --build`
    
    - 코드를 수정했으면 `-build` 옵션을 붙여야 이미지를 새로 굽고 실행합니다.

---

**요약하자면 다음 순서로 진행해 보세요:**

1. `docker rm -f <기존컨테이너명>` (삭제)
2. `docker build -t <이미지명> .` (코드 반영 빌드)
3. `docker run -d -p 10016:<내부포트> --name <기존컨테이너명> <이미지명>` (재실행)